var timeoutID=null;var islogin=true;var pageSize=20;var currentStore=null;var emptySearchText="输入关键词";Ext.BLANK_IMAGE_URL="resources/images/default/s.gif";function showMsg(A){$("msg_content").innerHTML=A+" <a href=# onclick='clearMsg();return false;'><img src='resources/images/close.gif'/></a>";$("msg").style.display="block";if(timeoutID!=null){clearTimeout(timeoutID)}timeoutID=setTimeout("clearMsg()",30000)}function clearMsg(){$("msg").style.display="none";$("msg_content").innerHTML=""}var tabPanel=new Ext.TabPanel({id:"tabPanel",region:"center",enableTabScroll:true,deferredRender:false,activeTab:0,items:[{contentEl:"center",title:"欢迎使用",autoScroll:true,iconCls:"home"}]});var equipPanel=new Ext.TabPanel({activeTab:0,width:482,height:200,cls:"comp-left2",items:[{id:"equip_tab_0",title:"设备图片",xtype:"panel",html:'<div style="float:left;"><img id="equip_image" src="resources/images/indicator.gif"/></div><div style="padding:10px;" id="equip_tip">&nbsp;提示：<br/>&nbsp;图片正在加载中...</div>'},new Ext.form.TextArea({id:"equip_tab_1",title:"性能参数",name:"specification",width:378,maxLength:150}),new Ext.form.TextArea({id:"equip_tab_2",title:"操作规程",name:"caution",width:378,maxLength:1000}),new Ext.form.TextArea({id:"equip_tab_3",title:"收费方式",name:"remark",width:378,maxLength:1000})]});var a_equipPanel=new Ext.TabPanel({activeTab:0,width:482,height:200,cls:"comp-left2",items:[{id:"a_equip_tab_0",title:"设备图片",xtype:"panel",html:'<div style="padding:10px;">&nbsp;提示：<br/>&nbsp;请保存好设备信息后，用修改设备的方式添加图片。</div>'},new Ext.form.TextArea({id:"a_equip_tab_1",title:"性能参数",name:"specification",width:378,maxLength:150}),new Ext.form.TextArea({id:"a_equip_tab_2",title:"操作规程",name:"caution",width:378,maxLength:1000}),new Ext.form.TextArea({id:"a_equip_tab_3",title:"收费方式",name:"remark",width:378,maxLength:1000})]});var root=new Ext.tree.TreeNode({text:"设备查询",allowDrag:true,allowDrop:false,expanded:true});var equipManager=new Ext.tree.TreeNode({text:"所有设备",allowDrag:false,iconCls:"equip",expanded:true});equipManager.on("click",function(){updateTab("equipManager","所有设备")});var equipSearchList=new Ext.tree.TreeNode({text:"搜索设备",allowDrag:false,iconCls:"search"});equipSearchList.on("click",function(){updateTab("equipSearchList","搜索设备")});var equipCategoryList1=new Ext.tree.TreeNode({text:equipArray[1],allowDrag:false,iconCls:"equip"});var equipCategoryList2=new Ext.tree.TreeNode({text:equipArray[2],allowDrag:false,iconCls:"equip"});var equipCategoryList3=new Ext.tree.TreeNode({text:equipArray[3],allowDrag:false,iconCls:"equip"});equipCategoryList1.on("click",function(){updateTab("equipCategoryList1",equipArray[1])});equipCategoryList2.on("click",function(){updateTab("equipCategoryList2",equipArray[2])});equipCategoryList3.on("click",function(){updateTab("equipCategoryList3",equipArray[3])});equipManager.appendChild([equipCategoryList1,equipCategoryList2,equipCategoryList3]);root.appendChild([equipManager,equipSearchList]);Ext.onReady(function(){DWREngine.setTimeout(30000);Ext.QuickTips.init();Ext.form.Field.prototype.msgTarget="qtip";var E=new Ext.state.CookieProvider();var F=E.get("cookie_theme");if(F==null||F==""){F="resources/css/ext-all.css"}Ext.util.CSS.swapStyleSheet("theme",F);Ext.state.Manager.setProvider(E);var D=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["display","value"],data:themeArray}),renderTo:"theme-selector",displayField:"display",typeAhead:true,editable:false,mode:"local",triggerAction:"all",selectOnFocus:true,resizable:false,listWidth:100,width:100,valueField:"value",value:F});D.on("select",function(G){Ext.util.CSS.swapStyleSheet("theme",G.getValue());E.set("cookie_theme",G.getValue())},this);$("loading_div").parentNode.removeChild($("loading_div"));Ext.getDom("theme-selector").style.visibility="visible";$("account_div").style.visibility="visible";var A=new Ext.Viewport({layout:"border",items:[new Ext.BoxComponent({region:"north",el:"north-div",height:82}),new Ext.tree.TreePanel({region:"west",id:"west-panel",title:"菜单栏",split:true,width:200,minSize:175,maxSize:400,collapsible:true,margins:"0 0 0 0",root:root}),tabPanel]});var C=(window.innerWidth)?window.innerWidth:(document.documentElement&&document.documentElement.clientWidth)?document.documentElement.clientWidth:document.body.offsetWidth;if(C-265<800){C=1050}var B=new Ext.Panel({id:"main-panel",baseCls:"x-plain",renderTo:Ext.get("center"),layout:"table",layoutConfig:{columns:2},defaults:{frame:true,width:C-265,height:310},items:[{title:"使用说明",colspan:2,collapsible:true,contentEl:"home"}]})});function onClickMenuItem(A){updateTab(A.id,A.innerHTML)}function addTab(B,A){if(B.substring(0,17)=="equipCategoryList"){initEquipCategoryList(B,A)}else{switch(B){case"equipManager":initEquipManager(B,A);break;case"equipSearchList":initEquipSearchList(B,A);break;default:showMsg("此功能需要实现！")}}}function updateTab(C,B){var A=tabPanel.getItem(C);if(A){tabPanel.remove(A)}A=addTab(C,B);tabPanel.setActiveTab(A)}var addWin;var editWin;var uploadWin;var imageUploadWin;Ext.getDom("equip-edit-win").innerHTML="";Ext.getDom("equip-add-win").innerHTML="";Ext.getDom("equip-upload-win").innerHTML="";Ext.getDom("image-upload-win").innerHTML="";function showAddWin(){if(!addWin){var B=new Ext.FormPanel({labelWidth:100,frame:true,labelAlign:"right",buttonAlign:"left",defaultType:"textfield",items:[new Ext.form.Hidden({name:"id"}),new Ext.form.TextField({fieldLabel:"设备名称*",name:"name",width:378,maxLength:50,allowBlank:false}),new Ext.form.TextField({fieldLabel:"编号*",name:"no",width:132,maxLength:50,itemCls:"comp-left0",clearCls:"allow-float",allowBlank:false}),new Ext.form.TextField({fieldLabel:"型号*",name:"model",width:132,maxLength:50,itemCls:"comp-left",clearCls:"stop-float",allowBlank:false}),new Ext.form.TextField({fieldLabel:"单价",name:"price",itemCls:"comp-left0",clearCls:"allow-float",width:132,maxLength:50}),new Ext.form.TextField({fieldLabel:"存放位置",name:"location",itemCls:"comp-left",clearCls:"stop-float",width:132,maxLength:50}),new Ext.form.TextField({fieldLabel:"国别",name:"country",width:132,maxLength:50,itemCls:"comp-left0",clearCls:"allow-float"}),new Ext.form.TextField({fieldLabel:"生产厂商",name:"company",itemCls:"comp-left",clearCls:"stop-float",width:132,maxLength:50}),{xtype:"datefield",fieldLabel:"出厂日期",name:"year1",itemCls:"comp-left0",clearCls:"allow-float",width:132,format:"Y-m-d"},{xtype:"datefield",fieldLabel:"购置日期",name:"year2",itemCls:"comp-left",clearCls:"stop-float",width:132,format:"Y-m-d"},new Ext.form.ComboBox({fieldLabel:"设备类别*",hiddenName:"type",store:new Ext.data.SimpleStore({fields:["returnValue","displayValue"],data:equipArray2}),valueField:"returnValue",displayField:"displayValue",typeAhead:true,allowBlank:false,itemCls:"comp-left0",clearCls:"allow-float",width:132,mode:"local",triggerAction:"all",emptyText:"选择设备类别...",selectOnFocus:true,editable:false}),new Ext.form.TextField({fieldLabel:"负责人",name:"admin",width:132,value:username,itemCls:"comp-left",clearCls:"stop-float",maxLength:50}),new Ext.form.TextField({fieldLabel:"联系方式",name:"mobile",width:378,itemCls:"comp-left0",clearCls:"stop-float",maxLength:150}),a_equipPanel,new Ext.form.NumberField({fieldLabel:"处理时间(分/样)*",name:"sampletime",width:132,minValue:1,allowDecimals:false,maxLength:8,itemCls:"comp-left0",clearCls:"allow-float",allowBlank:false}),new Ext.form.NumberField({fieldLabel:"费用(元/分)*",name:"fee",width:132,decimalPrecision:2,minValue:0,maxLength:8,itemCls:"comp-left",clearCls:"stop-float",allowBlank:false}),{xtype:"checkbox",fieldLabel:"是否公用",boxLabel:"允许公用",itemCls:"comp-left0",clearCls:"allow-float",checked:false,name:"pub"},{xtype:"checkbox",fieldLabel:"是否收费",boxLabel:"收费",itemCls:"comp-left1",clearCls:"stop-float",checked:true,name:"charge"},{xtype:"checkbox",fieldLabel:"使用状态",boxLabel:"允许预约",itemCls:"comp-left0",clearCls:"allow-float",checked:false,name:"status"},{xtype:"checkbox",fieldLabel:"预约冲突",boxLabel:"检查",itemCls:"comp-left1",clearCls:"stop-float",checked:true,name:"checkd"},{xtype:"checkbox",fieldLabel:"允许预约日期",boxLabel:"周一",itemCls:"comp-left0",clearCls:"allow-float",checked:true,name:"appd1"},{xtype:"checkbox",boxLabel:"周二",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd2"},{xtype:"checkbox",boxLabel:"周三",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd3"},{xtype:"checkbox",boxLabel:"周四",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd4"},{xtype:"checkbox",boxLabel:"周五",hideLabel:true,itemCls:"comp-left2",clearCls:"stop-float",checked:true,name:"appd5"},{xtype:"checkbox",boxLabel:"周六",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:false,width:150,name:"appd6"},{xtype:"checkbox",boxLabel:"周日",hideLabel:true,itemCls:"comp-left2",clearCls:"stop-float",checked:false,width:150,name:"appd0"},{xtype:"timefield",fieldLabel:"预约起始时间*",name:"appt1",allowBlank:false,itemCls:"comp-left0",clearCls:"allow-float",increment:30,width:132,format:"H:i"},{xtype:"timefield",fieldLabel:"预约结束时间*",name:"appt2",allowBlank:false,itemCls:"comp-left",clearCls:"stop-float",increment:30,width:132,format:"H:i"}]});addWin=new Ext.Window({el:"equip-add-win",title:"新增设备记录",modal:true,layout:"fit",closeAction:"hide",width:520,height:620,resizable:false,items:[B],buttons:[{text:"保存",handler:function(){if(B.getForm().findField("appt1").getValue()>=B.getForm().findField("appt2").getValue()){B.getForm().findField("appt2").markInvalid("预约最晚时间应比最早时间晚！")}else{if(B.form.isValid()){var F=new Object();F.id=B.getForm().findField("id").getValue();F.name=B.getForm().findField("name").getValue();F.no=B.getForm().findField("no").getValue();F.model=B.getForm().findField("model").getValue();F.price=B.getForm().findField("price").getValue();F.specification=B.getForm().findField("specification").getValue();F.country=B.getForm().findField("country").getValue();var E=B.getForm().findField("year1").getValue();if(E!=""){E=E.format("Y-m-d")}F.year1=E;year2=B.getForm().findField("year2").getValue();if(year2!=""){year2=year2.format("Y-m-d")}F.year2=year2;F.type=B.getForm().findField("type").getValue();F.location=B.getForm().findField("location").getValue();F.admin=B.getForm().findField("admin").getValue();F.mobile=B.getForm().findField("mobile").getValue();F.company=B.getForm().findField("company").getValue();F.remark=B.getForm().findField("remark").getValue();F.caution=B.getForm().findField("caution").getValue();F.pub=B.getForm().findField("pub").getValue();F.charge=B.getForm().findField("charge").getValue();F.status=B.getForm().findField("status").getValue();F.sampletime=B.getForm().findField("sampletime").getValue();F.fee=B.getForm().findField("fee").getValue();F.checkd=B.getForm().findField("checkd").getValue();var C=new Array();for(var D=0;D<7;D++){if(B.getForm().findField("appd"+D).getValue()==false){C.push(D)}}if(C.length==7){Ext.Msg.alert("错误","允许预约日期至少要选一天！如果要禁止预约可以把“使用状态”取消勾选！");return }F.appd=C;F.appt1=B.getForm().findField("appt1").getValue();F.appt2=B.getForm().findField("appt2").getValue();addWin.hide();DWRUtil.useLoadingMessage("处理中...");Equip.saveEquip(Ext.encode(F),{callback:function(H){cancelLoadingMessage();var G=Ext.decode(H);if(G.result){B.form.reset();showMsg(G.message);currentStore.reload()}else{Ext.Msg.alert("报告",G.message)}},errorHandler:function(G){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})}}}},{text:"取消",handler:function(){addWin.hide()}}]})}addWin.show();for(var A=0;A<4;A++){a_equipPanel.setActiveTab("a_equip_tab_"+A)}a_equipPanel.setActiveTab("a_equip_tab_1")}var equiptip=null;function showEditWin(B){if(!editWin){var A=new Ext.FormPanel({labelWidth:100,frame:true,labelAlign:"right",buttonAlign:"left",defaultType:"textfield",items:[new Ext.form.Hidden({name:"id"}),new Ext.form.TextField({fieldLabel:"设备名称*",name:"name",width:378,maxLength:50,allowBlank:false}),new Ext.form.TextField({fieldLabel:"编号*",name:"no",width:132,maxLength:50,itemCls:"comp-left0",clearCls:"allow-float",allowBlank:false}),new Ext.form.TextField({fieldLabel:"型号*",name:"model",width:132,maxLength:50,itemCls:"comp-left",clearCls:"stop-float",allowBlank:false}),new Ext.form.TextField({fieldLabel:"单价",name:"price",itemCls:"comp-left0",clearCls:"allow-float",width:132,maxLength:50}),new Ext.form.TextField({fieldLabel:"存放位置",name:"location",itemCls:"comp-left",clearCls:"stop-float",width:132,maxLength:50}),new Ext.form.TextField({fieldLabel:"国别",name:"country",width:132,maxLength:50,itemCls:"comp-left0",clearCls:"allow-float"}),new Ext.form.TextField({fieldLabel:"生产厂商",name:"company",itemCls:"comp-left",clearCls:"stop-float",width:132,maxLength:50}),{xtype:"datefield",fieldLabel:"出厂日期",name:"year1",itemCls:"comp-left0",clearCls:"allow-float",width:132,format:"Y-m-d"},{xtype:"datefield",fieldLabel:"购置日期",name:"year2",itemCls:"comp-left",clearCls:"stop-float",width:132,format:"Y-m-d"},new Ext.form.ComboBox({fieldLabel:"设备类别*",hiddenName:"type",store:new Ext.data.SimpleStore({fields:["returnValue","displayValue"],data:equipArray2}),valueField:"returnValue",displayField:"displayValue",typeAhead:true,allowBlank:false,itemCls:"comp-left0",clearCls:"allow-float",width:132,mode:"local",triggerAction:"all",emptyText:"选择设备类别...",selectOnFocus:true,editable:false}),new Ext.form.TextField({fieldLabel:"负责人",name:"admin",width:132,itemCls:"comp-left",clearCls:"stop-float",maxLength:50}),new Ext.form.TextField({fieldLabel:"联系方式",name:"mobile",width:378,itemCls:"comp-left0",clearCls:"stop-float",maxLength:150}),equipPanel,new Ext.form.NumberField({fieldLabel:"处理时间(分/样)*",name:"sampletime",width:132,minValue:1,allowDecimals:false,maxLength:8,itemCls:"comp-left0",clearCls:"allow-float",allowBlank:false}),new Ext.form.NumberField({fieldLabel:"费用(元/分)*",name:"fee",width:132,decimalPrecision:2,minValue:0,maxLength:8,itemCls:"comp-left",clearCls:"stop-float",allowBlank:false}),{xtype:"checkbox",fieldLabel:"是否公用",boxLabel:"允许公用",itemCls:"comp-left0",clearCls:"allow-float",checked:false,name:"pub"},{xtype:"checkbox",fieldLabel:"是否收费",boxLabel:"收费",itemCls:"comp-left1",clearCls:"stop-float",checked:false,name:"charge"},{xtype:"checkbox",fieldLabel:"使用状态",boxLabel:"允许预约",itemCls:"comp-left0",clearCls:"allow-float",checked:false,name:"status"},{xtype:"checkbox",fieldLabel:"预约冲突",boxLabel:"检查",itemCls:"comp-left1",clearCls:"stop-float",checked:true,name:"checkd"},{xtype:"checkbox",fieldLabel:"允许预约日期",boxLabel:"周一",itemCls:"comp-left0",clearCls:"allow-float",checked:true,name:"appd1"},{xtype:"checkbox",boxLabel:"周二",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd2"},{xtype:"checkbox",boxLabel:"周三",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd3"},{xtype:"checkbox",boxLabel:"周四",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:true,name:"appd4"},{xtype:"checkbox",boxLabel:"周五",hideLabel:true,itemCls:"comp-left2",clearCls:"stop-float",checked:true,name:"appd5"},{xtype:"checkbox",boxLabel:"周六",hideLabel:true,itemCls:"comp-left2",clearCls:"allow-float",checked:false,width:150,name:"appd6"},{xtype:"checkbox",boxLabel:"周日",hideLabel:true,itemCls:"comp-left2",clearCls:"stop-float",checked:false,width:150,name:"appd0"},{xtype:"timefield",fieldLabel:"预约起始时间*",name:"appt1",allowBlank:false,itemCls:"comp-left0",clearCls:"allow-float",increment:30,width:132,format:"H:i"},{xtype:"timefield",fieldLabel:"预约结束时间*",name:"appt2",allowBlank:false,itemCls:"comp-left",clearCls:"stop-float",increment:30,width:132,format:"H:i"}]});editWin=new Ext.Window({el:"equip-edit-win",title:"修改设备记录",modal:true,layout:"fit",closeAction:"hide",width:520,height:620,resizable:false,items:[A],buttons:[{text:"保存",handler:function(){if(A.getForm().findField("appt1").getValue()>=A.getForm().findField("appt2").getValue()){A.getForm().findField("appt2").markInvalid("预约最晚时间应比最早时间晚！")}else{if(A.form.isValid()){var F=new Object();F.id=A.getForm().findField("id").getValue();F.name=A.getForm().findField("name").getValue();F.no=A.getForm().findField("no").getValue();F.model=A.getForm().findField("model").getValue();F.price=A.getForm().findField("price").getValue();F.specification=A.getForm().findField("specification").getValue();F.country=A.getForm().findField("country").getValue();var E=A.getForm().findField("year1").getValue();if(E!=""){E=E.format("Y-m-d")}F.year1=E;year2=A.getForm().findField("year2").getValue();if(year2!=""){year2=year2.format("Y-m-d")}F.year2=year2;F.type=A.getForm().findField("type").getValue();F.location=A.getForm().findField("location").getValue();F.admin=A.getForm().findField("admin").getValue();F.mobile=A.getForm().findField("mobile").getValue();F.company=A.getForm().findField("company").getValue();F.remark=A.getForm().findField("remark").getValue();F.caution=A.getForm().findField("caution").getValue();F.pub=A.getForm().findField("pub").getValue();F.charge=A.getForm().findField("charge").getValue();F.status=A.getForm().findField("status").getValue();F.sampletime=A.getForm().findField("sampletime").getValue();F.fee=A.getForm().findField("fee").getValue();F.checkd=A.getForm().findField("checkd").getValue();var C=new Array();for(var D=0;D<7;D++){if(A.getForm().findField("appd"+D).getValue()==false){C.push(D)}}if(C.length==7){Ext.Msg.alert("错误","允许预约日期至少要选一天！如果要禁止预约可以把“使用状态”取消勾选！");return }F.appd=C;F.appt1=A.getForm().findField("appt1").getValue();F.appt2=A.getForm().findField("appt2").getValue();editWin.hide();DWRUtil.useLoadingMessage("处理中...");Equip.updateEquip(Ext.encode(F),{callback:function(H){cancelLoadingMessage();var G=Ext.decode(H);if(G.result){A.form.reset();showMsg(G.message);currentStore.reload()}else{Ext.Msg.alert("报告",G.message)}},errorHandler:function(G){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})}}}},{text:"取消",handler:function(){editWin.hide()}}]})}DWRUtil.useLoadingMessage("处理中...");Equip.getEquipDetailInfoById(B,{callback:function(H){cancelLoadingMessage();if(!H){Ext.Msg.alert("错误","对不起，程序出现错误!");return }var F=Ext.data.Record.create([{name:"id",mapping:"id"}]);var D=Ext.decode(H);var G=new F(D);var C=G.data.appd;var I=[true,true,true,true,true,true,true];for(var E=0;E<C.length;E++){I[C[E]]=false}for(var E=0;E<I.length;E++){G.data["appd"+E]=I[E]}editWin.show();for(var E=0;E<4;E++){equipPanel.setActiveTab("equip_tab_"+E)}document.getElementById("equip_image").style.width=227+"px";document.getElementById("equip_image").style.height=170+"px";if(G.data.image==""){document.getElementById("equip_image").src="resources/images/unuploaded.jpg";document.getElementById("equip_tip").innerHTML='&nbsp;提示：<br/>&nbsp;<li>该设备暂时未添加图片</li><br/>&nbsp;<li><a href="#" onclick=\'showImageUploadWin("'+G.data.id+"\");return false;'>上传新图片</a></li>"}else{document.getElementById("equip_image").src="resources/equip/"+G.data.image+"?"+Math.random();document.getElementById("equip_tip").innerHTML='&nbsp;提示：<br/>&nbsp;<li><a href="#" onclick=\'showImageUploadWin("'+G.data.id+'");return false;\'>重新上传图片</a></li><br/>&nbsp;<li><a href="#" onclick=\'deleteEquipImage("'+G.data.id+"\");return false;'>删除该图片</a></li><br/>"}equipPanel.setActiveTab("equip_tab_0");editWin.items.last().getForm().loadRecord(G);if(equiptip!=null){equiptip.destroy()}if(G.data.image!=""){}else{equiptip=new Ext.ToolTip({target:Ext.get("equip_image"),html:'<font color="red">该设备暂时无图片！</font>',frame:true,dismissDelay:0,showDelay:0,hideDelay:200})}},errorHandler:function(C){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})}function showUploadWin(){if(!uploadWin){var A=new Ext.form.FormPanel({labelWidth:85,labelAlign:"right",frame:true,fileUpload:true,items:[{xtype:"textfield",fieldLabel:"选择Excel文件",name:"file",height:25,width:270,inputType:"file"},{xtype:"checkbox",fieldLabel:"",labelSeparator:"",boxLabel:"在‘说明描述’栏附加时间戳和签名",name:"remark"},{html:"<font color=green>请确保您上传的是Excel2003格式的文件，且格式符合导入规则;<br/>如果不了解格式要求，请先导出为Excel修改后再导入；</font><br/><font color=red>只有组别为‘管理所有设备’的系统管理员才能进行导入操作。</font>"}],buttons:[{text:"上传并导入",handler:function(){var C=A.getForm().findField("file").getValue();var B=C.substring(C.lastIndexOf(".")+1,C.length).toLowerCase();if(B=="xls"){uploadWin.hide();A.getForm().submit({url:"equipupload?remark="+A.getForm().findField("remark").getValue(),success:function(D,E){if(E.result.result){showMsg(E.result.msg);currentStore.reload();uploadWin=null;Ext.getDom("equip-upload-win").innerHTML=""}else{Ext.Msg.alert("错误",E.result.msg)}},failure:function(){Ext.Msg.alert("错误","导入失败，请检查文件是否为Excel且格式正确且设备编号没有冲突！")},waitMsg:"正在进行上传处理，请稍候..."})}else{A.getForm().findField("file").markInvalid("请选择要导入的文件（扩展名为xls）！")}}},{text:"取消",handler:function(){uploadWin.hide()}}]});uploadWin=new Ext.Window({el:"equip-upload-win",title:"导入Excel文件到设备库",modal:true,layout:"fit",closeAction:"hide",width:410,height:180,resizable:false,items:[A]})}uploadWin.show()}function showImageUploadWin(A){if(!imageUploadWin){var B=new Ext.form.FormPanel({labelWidth:85,labelAlign:"right",frame:true,fileUpload:true,items:[{xtype:"textfield",fieldLabel:"选择图片文件",name:"file",height:25,width:270,inputType:"file"},{html:"请确保您上传的图片文件为<font color=red>*.jpg</font>，没有损坏，且您有权限。建议的图片长宽为600×450，请不要上传低于90×50的图片！"}],buttons:[{text:"上传",handler:function(){var D=B.getForm().findField("file").getValue();var C=D.substring(D.lastIndexOf(".")+1,D.length).toLowerCase();if(C=="jpg"){imageUploadWin.hide();B.getForm().submit({url:"imageupload?equipid="+A,success:function(E,F){if(F.result.result){showMsg(F.result.msg);document.getElementById("equip_image").src="resources/equip/"+A+".jpg?"+Math.random();document.getElementById("equip_tip").innerHTML='&nbsp;提示：<br/>&nbsp;<font color="green">'+F.result.msg+'</font><br/>&nbsp;<li><a href="#" onclick=\'showImageUploadWin("'+A+'");return false;\'>重新上传图片</a></li><br/>&nbsp;<li><a href="#" onclick=\'deleteEquipImage("'+A+"\");return false;'>删除该图片</a></li><br/>";if(equiptip!=null){equiptip.destroy()}imageUploadWin=null;Ext.getDom("image-upload-win").innerHTML=""}else{Ext.Msg.alert("错误",F.result.msg)}},failure:function(){Ext.Msg.alert("错误","导入失败，请检查上传的图片文件是jpg格式，符合规格，且没有损坏！")},waitMsg:"正在进行上传处理，请稍候..."})}else{B.getForm().findField("file").markInvalid("请选择要上传的图片文件（扩展名jpg）！")}}},{text:"取消",handler:function(){imageUploadWin.hide()}}]});imageUploadWin=new Ext.Window({el:"image-upload-win",title:"上传图片",modal:true,layout:"fit",closeAction:"hide",width:410,height:150,resizable:false,items:[B]})}imageUploadWin.show()}function deleteEquipImage(A){Ext.MessageBox.confirm("确认删除该设备的图片","确认删除该设备的图片？",function(B){if("yes"!=B){return }DWRUtil.useLoadingMessage("处理中...");Equip.removeEquipImage(A,{callback:function(D){cancelLoadingMessage();var C=Ext.decode(D);if(C.result){showMsg(C.message);document.getElementById("equip_image").src="resources/images/unuploaded.jpg";document.getElementById("equip_tip").innerHTML='&nbsp;提示：<br/>&nbsp;<li>该设备暂时未添加图片</li><br/>&nbsp;<li><a href="#" onclick=showImageUploadWin("'+A+'");return false;>上传新图片</a></li>';if(equiptip!=null){equiptip.destroy()}equiptip=new Ext.ToolTip({target:Ext.get("equip_image"),html:'<font color="red">该设备暂时无图片！</font>',frame:true,dismissDelay:0,showDelay:0,hideDelay:200})}else{Ext.Msg.alert("报告",C.message)}},errorHandler:function(C){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})})};