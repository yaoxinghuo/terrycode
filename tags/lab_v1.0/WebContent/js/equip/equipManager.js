function initEquipManager(B,E){Ext.getDom("eq-content").innerTHML="";var F=new Ext.data.DWRJsonReader({totalProperty:"results",root:"rows"},new Ext.data.Record.create([{name:"id",mapping:"id"},{name:"no",mapping:"no"},{name:"name",mapping:"name"},{name:"admin",mapping:"admin"},{name:"model",mapping:"model"},{name:"company",mapping:"company"},{name:"type",mapping:"type"},{name:"status",mapping:"status"},{name:"charge",mapping:"charge"},{name:"pub",mapping:"pub"}]));var I=new Ext.data.GroupingStore({proxy:new Ext.data.DWRProxy({dwrFunction:Equip.getEquipsInfo,listeners:{beforeload:function(L,M){M[L.loadArgsKey]=[M.start,M.limit,false]}}}),reader:F,groupField:"name",groupOnSort:true,sortInfo:{field:"type",direction:"ASC"}});var C=new Ext.grid.CheckboxSelectionModel();var J=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),C,{header:"设备编号",width:100,sortable:true,dataIndex:"no"},{header:"设备名称",width:150,sortable:true,dataIndex:"name"},{header:"型号",width:150,sortable:true,dataIndex:"model"},{header:"负责人",width:100,sortable:true,dataIndex:"admin"},{header:"生产厂商",width:150,sortable:true,dataIndex:"company"},{header:"分类",width:100,sortable:true,dataIndex:"type",renderer:function(L){return equipArray[L]}},{header:"是否公用",width:80,sortable:true,dataIndex:"pub",renderer:function(L){if(L){return"<span style='color:green;'>是</span>"}else{return"<span style='color:red;'>否</span>"}}},{header:"是否收费",width:80,sortable:true,dataIndex:"charge",renderer:function(L){if(L){return"<span style='color:red;'>是</span>"}else{return"<span style='color:green;'>否</span>"}}},{header:"状态",width:100,sortable:true,dataIndex:"status",renderer:function(L){if(L){return"<span style='color:green;'>接受预约</span>"}else{return"<span style='color:red;'>暂不可用</span>"}}}]);var A=new Ext.grid.GridPanel({id:B,title:E,border:false,store:I,renderTo:"eq-content",header:false,cm:J,sm:C,view:new Ext.grid.GroupingView({forceFit:true,sortAscText:"正序",sortDescText:"倒序",columnsText:"列显示/隐藏",groupByText:"依本列分组",showGroupsText:"分组显示",groupTextTpl:"{text} ({[values.rs.length]} 条记录)"}),loadMask:true,iconCls:"equip",closable:true,tbar:[{text:"新增设备",tooltip:"新增设备记录",iconCls:"add",onClick:function(){currentStore=I;showAddWin()}},"-",{text:"批量删除",tooltip:"批量删除",iconCls:"remove",onClick:function(){if(C.hasSelection()){var N=C.getSelections();if(N.length==1){D();return }var M=[];for(var L=0;L<N.length;L++){M[L]=N[L].data.id}H(M)}else{showMsg("请至少选择一条记录!")}}},"-",{text:"刷新",tooltip:"刷新",iconCls:"refresh",onClick:function(){I.reload()}},"-",{text:"导出为Excel",tooltip:"导出为Excel并下载到本地",iconCls:"excel",onClick:function(){window.location.href="equipdownload?type=1&arg1=null&arg2=null"}},{text:"导入Excel",tooltip:"把本地Excel文件导入到设备库",iconCls:"excel",onClick:function(){currentStore=I;showUploadWin()}},"-",{text:"Tip:请选择设备记录操作或单击记录的右键菜单",xtype:"tbtext"}],bbar:new Ext.PagingToolbar({pageSize:pageSize,store:I,displayInfo:true})});I.load({params:{start:0,limit:pageSize}});var G=new Ext.menu.Menu({id:"equiprightClickCont",items:[{id:"equipDetailMenu",handler:K,iconCls:"detail",text:"查看/修改详情"},{id:"equipRemoveMenu",handler:D,iconCls:"remove",text:"删除设备"}]});A.addListener("rowcontextmenu",function(M,L,N){N.preventDefault();M.getSelectionModel().selectRow(L);G.showAt(N.getXY())});tabPanel.add(A).show();function H(L){Ext.MessageBox.confirm("确认批量删除设备记录","是否确认批量删除设备记录？<br><b>建议删除设备之前先导出该设备的预约记录！</b>",function(M){if("yes"!=M){return }DWRUtil.useLoadingMessage("处理中...");Equip.batchRemoveEquip(L,{callback:function(O){cancelLoadingMessage();var N=Ext.decode(O);if(N.result){I.reload();showMsg(N.message)}else{Ext.Msg.alert("报告",N.message)}},errorHandler:function(N){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})})}function D(){var L=A.getSelectionModel().getSelected();if(!L){return }Ext.MessageBox.confirm("确认删除设备记录","是否确认删除设备记录？<br><b>建议删除设备之前先导出该设备的预约记录！</b>",function(M){if("yes"!=M){return }DWRUtil.useLoadingMessage("处理中...");Equip.removeEquip(L.data.id,{callback:function(O){cancelLoadingMessage();var N=Ext.decode(O);if(N.result){I.remove(L);showMsg(N.message)}else{Ext.Msg.alert("报告",N.message)}},errorHandler:function(N){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})})}function K(){var L=A.getSelectionModel().getSelected();if(!L){return }currentStore=I;showEditWin(L.data.id)}};