function initAdminLogManager(L,S){Ext.getDom("admin-log-content").innerTHML="";var B=null;var I=null;var O=-1;var K=new Date();var P=K.format("Y-m-d");K.setMonth(new Date().getMonth()-1);var F=K.format("Y-m-d");var T="";var E="no";var D=new Ext.data.DWRJsonReader({totalProperty:"results",root:"rows"},new Ext.data.Record.create([{name:"id",mapping:"id"},{name:"input",mapping:"input"},{name:"equip_id",mapping:"equip_id"},{name:"equip_name",mapping:"equip_name"},{name:"equip_no",mapping:"equip_no"},{name:"user_name",mapping:"user_name"},{name:"user_id",mapping:"user_id"},{name:"admin_id",mapping:"admin_id"},{name:"action",mapping:"action"},{name:"admin_name",mapping:"admin_name"},{name:"start",mapping:"start"},{name:"end",mapping:"end"},{name:"teacher",mapping:"teacher"},{name:"sample",mapping:"sample"},{name:"fee",mapping:"fee"},{name:"exp_time",mapping:"exp_time"},{name:"content",mapping:"content"},{name:"remark",mapping:"remark"},{name:"charge",mapping:"charge"},{name:"admin_remark",mapping:"admin_remark"}]));I=new Ext.data.Store({proxy:new Ext.data.DWRProxy({dwrFunction:Book.getLogsInfo,listeners:{beforeload:function(U,V){V[U.loadArgsKey]=[V.start,V.limit,O,F,P,T,E]}}}),reader:D});var Q=new Ext.grid.CheckboxSelectionModel();var J=new Ext.grid.ColumnModel([new Ext.grid.RowNumberer(),Q,{header:"审批日期",width:100,sortable:true,dataIndex:"input"},{header:"设备名称",width:100,sortable:true,dataIndex:"equip_name"},{header:"设备编号",width:100,sortable:true,dataIndex:"equip_no"},{header:"是否收费",width:70,sortable:true,hidden:true,dataIndex:"charge",renderer:function(U){if(U){return"<font color='red'>是</font>"}else{return"<font color='green'>否</font>"}}},{header:"申请人",width:80,sortable:true,dataIndex:"user_name"},{header:"导师",width:80,sortable:true,dataIndex:"teacher"},{header:"审批人",width:80,sortable:true,dataIndex:"admin_name"},{header:"审批情况",width:80,sortable:true,dataIndex:"action",renderer:function(U){if(U==0){return"<font color=blue>未批准</font>"}else{if(U==2){return"<font color=red>已删除</font>"}else{if(U==3){return"改费用"}else{return"<font color=green>已批准</font>"}}}}},{header:"样品/数量",width:120,sortable:true,dataIndex:"sample"},{header:"实验时长",width:60,sortable:true,dataIndex:"exp_time"},{header:"实验/应收费用",width:100,sortable:true,dataIndex:"fee"},{header:"起始日期",width:100,sortable:true,dataIndex:"start"},{header:"中止日期",width:100,sortable:true,dataIndex:"end"},{header:"预约内容",width:150,sortable:true,dataIndex:"content"},{header:"费用备注",width:150,sortable:true,dataIndex:"remark"},{header:"负责人附言",width:150,sortable:true,dataIndex:"admin_remark"}]);var N=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["returnValue","displayValue"],data:[[-1,"所有类型"],[0,"未批准"],[1,"已批准"],[3,"改费用"],[2,"已删除"]]}),valueField:"returnValue",displayField:"displayValue",allowBlank:false,typeAhead:true,mode:"local",triggerAction:"all",value:-1,width:78,editable:false,selectOnFocus:true});var A=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["returnValue","displayValue"],data:[["equip_name","设备名称"],["equip_no","设备编号"],["user_name","申请人"],["admin_name","负责人"],["teacher","导师姓名"],["sample_name","样品名称"],["content","预约内容"],["remark","费用备注"],["admin_remark","负责人附言"]]}),valueField:"returnValue",displayField:"displayValue",allowBlank:false,typeAhead:true,editable:false,mode:"local",triggerAction:"all",value:"equip_name",width:85,editable:false,selectOnFocus:true});B=new Ext.grid.GridPanel({id:L,title:S,border:false,ds:I,renderTo:"admin-log-content",header:false,cm:J,sm:Q,loadMask:true,iconCls:"unit",closable:true,bbar:new Ext.PagingToolbar({pageSize:pageSize,store:I,displayInfo:true}),tbar:[{text:"批量删除",tooltip:"批量删除",iconCls:"remove",onClick:function(){if(Q.hasSelection()){var W=Q.getSelections();if(W.length==1){M();return }var V=[];for(var U=0;U<W.length;U++){V[U]=W[U].data.id}H(V)}else{showMsg("请至少选择一条记录!")}}},"-",{text:"审批类型:",xtype:"tbtext"},N,{text:"日期从",xtype:"tbtext"},{xtype:"datefield",format:"Y-m-d",id:"a_startDate",width:90,value:F},{text:"到",xtype:"tbtext"},{xtype:"datefield",format:"Y-m-d",id:"a_endDate",width:90,value:P},{id:"keyword",xtype:"textfield",emptyText:emptySearchText,width:80,listeners:{specialkey:function(V,U){if(U.getKey()==Ext.EventObject.ENTER){if(Ext.getCmp("a_startDate").isValid()&&Ext.getCmp("a_endDate").isValid()){O=N.getValue();F=Ext.getCmp("a_startDate").getEl().getValue();P=Ext.getCmp("a_endDate").getEl().getValue();T=Ext.getCmp("keyword").getEl().getValue();if(T==emptySearchText){T=""}E=A.getValue();I.reload({params:{start:0,limit:pageSize}})}}}}},{text:"搜索字段:",xtype:"tbtext"},A,{text:"查询",tooltip:"请输入前面的条件后查询",iconCls:"search",onClick:function(){if(Ext.getCmp("a_startDate").isValid()&&Ext.getCmp("a_endDate").isValid()){O=N.getValue();F=Ext.getCmp("a_startDate").getEl().getValue();P=Ext.getCmp("a_endDate").getEl().getValue();T=Ext.getCmp("keyword").getEl().getValue();if(T==emptySearchText){T=""}E=A.getValue();I.reload({params:{start:0,limit:pageSize}})}}},{text:"导出为Excel",tooltip:"导出为成Excel并下载到本地",iconCls:"excel",onClick:function(){window.location.href="report?type=2&action="+O+"&startDate="+F+"&endDate="+P+"&keyword="+T+"&column="+E}}]});I.load({params:{start:0,limit:pageSize}});var C=new Ext.menu.Menu({id:"adminlogrightClickCont",items:[{id:"adminlogDetailMenu",handler:G,iconCls:"detail",text:"查看/修改设备详情"},{id:"adminlogMessageMenu",handler:R,iconCls:"view",text:"查看预约内容"},{id:"adminlogDeleteMenu",handler:M,iconCls:"remove",text:"删除"}]});B.addListener("rowcontextmenu",function(V,U,W){W.preventDefault();V.getSelectionModel().selectRow(U);C.showAt(W.getXY())});tabPanel.add(B).show();function G(){var U=B.getSelectionModel().getSelected();if(!U){return }currentStore=null;showEquipEditWin(U.data.equip_id)}function M(){var U=B.getSelectionModel().getSelected();if(!U){return }Ext.MessageBox.confirm("确认删除审批日志","是否确认删除审批日志？",function(V){if("yes"!=V){return }DWRUtil.useLoadingMessage("处理中...");Book.deleteLog(U.data.id,{callback:function(X){cancelLoadingMessage();var W=Ext.decode(X);if(W.result){I.remove(U);showMsg(W.message)}else{Ext.Msg.alert("报告",W.message)}},errorHandler:function(W){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})})}function H(U){Ext.MessageBox.confirm("确认批量删除审批日志","是否确认批量删除审批日志？",function(V){if("yes"!=V){return }DWRUtil.useLoadingMessage("处理中...");Book.batchDeleteLogs(U,{callback:function(X){cancelLoadingMessage();var W=Ext.decode(X);if(W.result){I.reload();showMsg(W.message)}else{Ext.Msg.alert("报告",W.message)}},errorHandler:function(W){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})})}function R(){var U=B.getSelectionModel().getSelected();if(!U){return }DWRUtil.useLoadingMessage("处理中...");Book.adminMessageBook(U.data.id,{callback:function(V){cancelLoadingMessage();Ext.MessageBox.show({title:"查看预约内容",msg:"以下显示预约内容",width:350,buttons:Ext.MessageBox.OK,multiline:true,value:V})},errorHandler:function(V){Ext.Msg.alert("错误","对不起，程序出现错误!");cancelLoadingMessage()}})}};