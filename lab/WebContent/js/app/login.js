var islogin=false;var timeoutID=null;function showMsg(A){$("msg_content").innerHTML=A+" <a href=# onclick='clearMsg();return false;'><img src='resources/images/close.gif'/></a>";$("msg").style.display="block";if(timeoutID!=null){clearTimeout(timeoutID)}timeoutID=setTimeout("clearMsg()",30000)}function clearMsg(){$("msg").style.display="none";$("msg_content").innerHTML=""}function userlogout(){DWREngine.setAsync(false);Account.logout();cp.set("login_cookie",null);DWREngine.setAsync(true);$("account_content").innerHTML="<a href='#' onclick='showLoginWin();return false;'>登录</a>&nbsp;|&nbsp;<a href='index.action'>转到首页</a>&nbsp;|&nbsp;<a href='equipview.action'>设备查询系统</a>";showMsg("您已经成功注销，再次登录请<a href='javascript:;' onclick='showLoginWin();'>单击这里</a></span>");islogin=false;$("validate_img").src="image?"+Math.random();$("my-yuyue").style.visibility="hidden";$("my-shengpi").style.visibility="hidden";for(var A=tabPanel.items.length-1;A>=6;A--){var B=tabPanel.getItem(tabPanel.items.get(A).id);if(B){tabPanel.remove(B)}}tabPanel.setActiveTab(tabPanel.items.get(0))}function getWelcomeMessage(A){islogin=true;return accountHTML="欢迎 "+A+'&nbsp;|&nbsp;<a href="#" onclick="initUserAccount();return false;">我的帐户</a>&nbsp;|&nbsp;<a href="index.action">转到首页</a>&nbsp;|&nbsp;<a href="equipview.action">设备查询系统</a>&nbsp;|&nbsp;<a href="#" onclick="userlogout();return false;">退出</a>'}window.onresize=function(){if($("login_mask").style.visibility=="visible"){var A=getViewportInfo();$("login_mask").style.width=A.width+"px";$("login_mask").style.height=A.height+"px";$("login_box").style.left=(A.width-350)/2+"px";$("login_box").style.top=(A.height-350)/2+"px"}};function getViewportInfo(){var A=(window.innerWidth)?window.innerWidth:(document.documentElement&&document.documentElement.clientWidth)?document.documentElement.clientWidth:document.body.offsetWidth;var B=(window.innerHeight)?window.innerHeight:(document.documentElement&&document.documentElement.clientHeight)?document.documentElement.clientHeight:document.body.offsetHeight;return{width:A,height:B}}function showLoginWin(){var A=getViewportInfo();$("login_mask").style.width=A.width+"px";$("login_mask").style.height=A.height+"px";$("login_mask").style.visibility="visible";$("login_box").style.left=(A.width-350)/2+"px";$("login_box").style.top=(A.height-350)/2+"px";$("login_message").innerHTML="&nbsp;";$("login_box").style.visibility="visible";$("login_form").no.focus();$("cookie_saveCookie").checked=loadSaveCookie();$("login_box").onkeydown=keydown}function keydown(A){A=A||window.event;if(A.keyCode==13){userlogin()}}function hideLoginBox(){$("login_box").style.visibility="hidden";$("login_mask").style.visibility="hidden"}function observerKeyDown(A){var B=Event.element(A);if(A.keyCode==13){userlogin()}}function userlogin(){var E=$("login_form");var D=$("login_message");var H=E.no.value;var C=E.password.value;var G=E.validate.value;var F=E.saveCookie.checked;if(!H){showLoginMsg(true,"用户名 不能为空！");E.no.focus();return }if(!C){showLoginMsg(true,"密码 不能为空！");E.password.focus();return }if(!G){showLoginMsg(true,"验证码 不能为空！");E.validate.focus();return }showLoginMsg(false,"登录中,请稍候...");var B=loginValidator(G,H,C,F);$("validate_img").src="image?"+Math.random();if(B==null||B==""){E.validate.value="";showLoginMsg(true,"对不起，程序出现错误!");return }var A=Ext.decode(B);if(A.type==0){hideLoginBox();E.reset();if(F){cp.set("login_cookie",A.cookievalue)}else{cp.set("login_cookie",null)}$("account_content").innerHTML=getWelcomeMessage(A.message);$("my-yuyue").style.visibility="visible";$("my-shengpi").style.visibility="visible";getRecentLogsNotice()}else{E.validate.value="";showLoginMsg(true,A.message)}}function loginValidator(E,D,B,C){var A=null;DWRUtil.useLoadingMessage("处理中...");DWREngine.setAsync(false);Account.login(E,D,B,C,{callback:function(F){cancelLoadingMessage();A=F},errorHandler:function(F){cancelLoadingMessage();showLoginMsg(true,"对不起，程序出现错误!");DWREngine.setAsync(true)}});DWREngine.setAsync(true);return A}function showLoginMsg(B,C){var A=$("login_message");if(B){A.innerHTML="<font color=red>"+C+"</font>"}else{A.innerHTML="<font color=green>"+C+"</font>"}}function mouseOver(A,B){oldClass=A.className;A.className=B}function mouseOut(A,B){A.className=B}function getCookie(C){var D=document.cookie.indexOf(C+"=");var A=D+C.length+1;if((!D)&&(C!=document.cookie.substring(0,C.length))){return null}if(D==-1){return null}var B=document.cookie.indexOf(";",A);if(B==-1){B=document.cookie.length}return unescape(document.cookie.substring(A,B))}function setCookie(C,E,A,H,D,G){var B=new Date();B.setTime(B.getTime());if(A){A=A*1000*60*60*24}var F=new Date(B.getTime()+(A));document.cookie=C+"="+escape(E)+((A)?";expires="+F.toGMTString():"")+((H)?";path="+H:"")+((D)?";domain="+D:"")+((G)?";secure":"")}function rememberSaveCookie(){var A=$("cookie_saveCookie").checked;setCookie("cookie_saveCookie",A,30)}function loadSaveCookie(){var A=getCookie("cookie_saveCookie");if(A==null||A=="true"){return true}return false};